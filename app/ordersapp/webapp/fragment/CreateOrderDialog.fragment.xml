<core:FragmentDefinition xmlns="sap.m" xmlns:core="sap.ui.core">
  <Dialog
    id="createOrderDialog"
    title="Nieuwe order"
    contentWidth="46rem"
    contentHeight="34rem"
    draggable="true"
    resizable="true">

    <content>
      <VBox class="sapUiMediumMargin">

        <!-- Stap 1: klant kiezen of nieuwe klant toevoegen -->
        <Toolbar>
          <Title text="Stap 1: Klant" level="H3"/>
          <ToolbarSpacer/>
          <Button text="Nieuwe klant" icon="sap-icon://add-contact" press=".onOpenNewCustomer"/>
        </Toolbar>

        <Label text="Kies bestaande klant" required="true"/>
        <Select
          id="selCustomer"
          width="100%"
          selectedKey="{create>/customerId}"
          items="{ path: '/Customers' }">
          <items>
            <core:Item
              key="{ID}"
              text="{= (${firstName} || '') + ' ' + (${lastName} || '') }"/>
          </items>
        </Select>

        <!-- Inline "nieuwe klant" panel -->
        <Panel
          headerText="Nieuwe klant toevoegen"
          expandable="true"
          expanded="true"
          visible="{create>/newCustomerMode}"
          class="sapUiSmallMarginTop">

          <content>
            <VBox class="sapUiSmallMargin">
              <Label text="Voornaam" required="true"/>
              <Input id="inpNewFirstName" value="{create>/newCustomer/firstName}" width="100%"/>

              <Label class="sapUiSmallMarginTop" text="Achternaam" required="true"/>
              <Input id="inpNewLastName" value="{create>/newCustomer/lastName}" width="100%"/>

              <Label class="sapUiSmallMarginTop" text="E-mail (optioneel)"/>
              <Input id="inpNewEmail" value="{create>/newCustomer/email}" width="100%" type="Email"/>

              <HBox class="sapUiSmallMarginTop" justifyContent="End">
                <Button text="Annuleren" type="Transparent" press=".onCancelNewCustomer"/>
                <Button text="Klant opslaan" type="Emphasized" icon="sap-icon://save" press=".onSaveNewCustomer"/>
              </HBox>
            </VBox>
          </content>
        </Panel>

        <!-- Stap 2: order type -->
        <Label class="sapUiSmallMarginTop" text="Stap 2: Order type" required="true"/>
        <Select
          id="selOrderType"
          width="100%"
          selectedKey="{create>/orderType}"
          change=".onOrderTypeChange">
          <items>
            <core:Item key="Tickets" text="Tickets"/>
            <core:Item key="Merch"   text="Merch"/>
            <core:Item key="Food"    text="Food"/>
          </items>
        </Select>

        <!-- Uitbreiding: betaalmethode simuleren -->
        <Label class="sapUiSmallMarginTop" text="(Uitbreiding) Betaalmethode (simulatie)"/>
        <Select
          id="selPayment"
          width="100%"
          selectedKey="{create>/paymentMethod}">
          <items>
            <core:Item key="Bancontact" text="Bancontact"/>
            <core:Item key="VISA" text="VISA"/>
          </items>
        </Select>

        <!-- Stap 3: items -->
        <Toolbar class="sapUiSmallMarginTop">
          <Title text="Stap 3: Items" level="H3"/>
          <ToolbarSpacer/>
          <Button text="Item toevoegen" icon="sap-icon://add" press=".onAddCreateItem"/>
        </Toolbar>

        <Table
          id="tblItems"
          items="{create>/items}"
          mode="Delete"
          delete=".onDeleteCreateItem"
          class="sapUiSmallMarginTop">

          <columns>
            <Column width="18rem"><Text text="Product"/></Column>
            <Column width="6rem" hAlign="End"><Text text="Aantal"/></Column>
            <Column width="8rem" hAlign="End"><Text text="Unit"/></Column>
            <Column width="8rem" hAlign="End"><Text text="Totaal"/></Column>
          </columns>

          <items>
            <ColumnListItem>
              <cells>

                <Select
                  width="100%"
                  selectedKey="{create>productId}"
                  items="{ path: '/Products' }"
                  change=".onRecalcCreateTotals">
                  <items>
                    <core:Item key="{ID}" text="{name}"/>
                  </items>
                </Select>

                <Input
                  type="Number"
                  textAlign="End"
                  value="{create>qty}"
                  liveChange=".onRecalcCreateTotals"/>

                <ObjectNumber
                  number="{
                    path: 'create>unitPrice',
                    type: 'sap.ui.model.type.Float',
                    formatOptions: { maxFractionDigits: 2 }
                  }"
                  unit="{create>/currency_code}"/>

                <ObjectNumber
                  number="{
                    path: 'create>lineTotal',
                    type: 'sap.ui.model.type.Float',
                    formatOptions: { maxFractionDigits: 2 }
                  }"
                  unit="{create>/currency_code}"/>

              </cells>
            </ColumnListItem>
          </items>
        </Table>

        <!-- Stap 4: samenvatting -->
        <HBox class="sapUiSmallMarginTop" justifyContent="End">
          <Text text="Totaal:" class="sapUiTinyMarginEnd"/>
          <ObjectNumber
            number="{
              path: 'create>/totalAmount',
              type: 'sap.ui.model.type.Float',
              formatOptions: { maxFractionDigits: 2 }
            }"
            unit="{create>/currency_code}"/>
        </HBox>

      </VBox>
    </content>

    <beginButton>
      <Button text="Aanmaken" type="Emphasized" press=".onCreateOrder"/>
    </beginButton>
    <endButton>
      <Button text="Annuleren" press=".onCloseCreateOrder"/>
    </endButton>

  </Dialog>
</core:FragmentDefinition>
